## 雅图伴侣 Home Assistant 集成组件

本组件实现雅图伴侣在Home Assistant 中展示运行状态并控制。

**感谢@bg6cq对项目的代码贡献，让此组件更为完善合理。**

### 安装

安装有两种方式，一种是手动安装，另一种是通过HACS安装，我们建议采用HACS安装，略微简单一些。

#### 手动安装：

在 Home Assistant 的 custom_components 目录下新建一个 airtub_udp
目录，然后将本项目 custom_components/airtub_udp 目录下所有文件复制到新建的
airtub_udp 目录下。

#### HACS安装：

打开HACS，选择【集成】，点击右上角【三个点】，选择【自定义存储库】，在弹出的对话框中，填入以下信息：

```
存储库填写 zenz/airtub_ha_reader
类别选择 集成
```

然后点击【添加】，在弹出的对话框中，选择【安装】即可。

### 配置

从菜单栏选择【配置】【设备与服务】【添加集成】，找到Airtub
Partner，点击添加，按照提示填写设备号，密码信息，选择采暖模式，确认即可。

### 使用

#### Sensor组件

添加后，可以在【配置】- 【设备与服务】-【实体】中找到 sensor.boiler_[device]_xxx
的实体，其中 device 为配置中的 device 值。

_xxx 的各项解释如下：

```
"flt": 故障状态 0-无故障 其它故障见雅图伴侣小程序的故障帮助
"fst": 火焰状态 0-未点火、1-点火
"mod": 当前燃气比例阀开度 0-100%
"cct": 当前采暖水温度
"cdt": 当前生活热水温度
"ccm": 当前采暖状态 0-未开启、1-开启
"cdm": 当前生活热水状态 0-未开启、1-开启
"tct": 目标采暖水温度 [可修改]
"tdt": 目标生活热水温度 [可修改]
"tcm": 目标采暖水模式 0-未开启、1-开启 [可修改]
"tdm": 目标生活热水模式 0-未开启、1-开启 [可修改]
"atm": 自动室温调节模式 0-未开启、1-开启 [可修改]
"odt": 当前室外温度
"coe": 当前采用的室外温度补偿系数 [可修改]
"crt": 当前室温
"trt": 目标室温 [可修改]
"sch": 自动任务状态 0-未开启、1-开启 [可修改]
"vir": 屏蔽高温杀菌模式 0-未开启、1-开启(仅系统炉) [可修改]
"tdf": 生活水启停温差(仅系统炉) [可修改]
"sch": 是否打开了定时任务
"tmd": 是否关闭低负荷处理
```

#### Climate组件

初始化完成，会同时提供两个Climate组件，分别是：

```
climate.boiler_[device]_ch 用于采暖控制
climate.boiler_[device]_dhw，用于生活热水控制。
```

### 提供的服务

```yaml
service: airtub_udp.sender
data:
  cmd: '{"tdm": 1, "tdt": 45}'
```

注意，只能接收json格式指令，可以多个指令一起发送。

### 可以发送给伴侣从而修改壁挂炉工作状态但不反馈的指令[非重复部分，]

```
"tmd": 是否取消低负荷模式，0-低负荷模式，1-关闭低负荷模式，冷凝炉可以关闭低负荷模式
"cst": 外部读取的温度值传送给雅图伴侣用作温度补偿计算用。必须大于-100，当输入-100时，关闭补偿计算功能。[仅在未连接有线室外温度传感器时使用]
"fce": 开关手动水温模式时是否强制升温模式，0-不启用，1-启用。本功能用于减少在采暖负荷需求小时快速超温熄火问题。
"ser" 伴侣的本地通讯形式由UDP组播改变为UDP点对点，例如HA所在网络IP地址是"192.168.1.1"，那么指定IP后，只发送给HA，用"0.0.0.0"来恢复UDP组播。此功能用于解决部分路由器对UDP组播的限制。
```
